import{_ as p,c as o,a as t,e as h,j as g,n as m,g as f,t as u,F as v,f as x,w as y,h as F,o as a}from"./index-C23T03Zw.js";const k={data(){return{files:[],userMessage:"",loading:!1,error:null,result:null,dragOver:!1}},computed:{hasTextFiles(){return this.files.some(s=>this.isTextFile(s))},hasLargeFile(){return this.files.some(s=>s.size>1024*1024)}},created(){this.loadDiagnosisFile()},methods:{isTextFile(s){if(!s)return!1;if(s.type.startsWith("text/"))return!0;const e=s.name.toLowerCase();return e.endsWith(".txt")||e.endsWith(".csv")||e.endsWith(".log")||e.endsWith(".json")||e.endsWith(".xml")},formatFileSize(s){if(s===0)return"0 Bytes";const e=1024,n=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,d)).toFixed(2))+" "+n[d]},handleFileChange(s){const e=Array.from(s.target.files);e.length>0&&(this.files=[...this.files,...e]),this.dragOver=!1},handleDrop(s){this.dragOver=!1;const e=Array.from(s.dataTransfer.files);e.length>0&&(this.files=[...this.files,...e])},removeFile(s){this.files.splice(s,1)},loadDiagnosisFile(){const s=localStorage.getItem("diagnosisFile");if(s){const e=this.$route.query.fileName||"diagnosis.txt",n=this.dataURLtoFile(s,e);this.files=[n],localStorage.removeItem("diagnosisFile")}},dataURLtoFile(s,e){const n=s.split(","),d=n[0].match(/:(.*?);/)[1],i=atob(n[1]);let l=i.length;const r=new Uint8Array(l);for(;l--;)r[l]=i.charCodeAt(l);return new File([r],e,{type:d})},async sendToAI(){if(this.files.length===0&&!this.userMessage.trim()){this.error="请上传文件或输入分析要求",setTimeout(()=>{this.error=null},3e3);return}if(this.hasTextFiles){const n=this.userMessage.trim().length>0;this.userMessage=`${n?this.userMessage+`

`:""}[上传文件提示] 检测到文本文件，已直接发送文件内容进行分析`}this.loading=!0,this.error=null,this.result=null;const s=new FormData;this.files.forEach(n=>{s.append("files",n)});const e=[];this.userMessage.trim()&&e.push({role:"user",content:this.userMessage}),s.append("messages",JSON.stringify(e));try{const n=await fetch("http://172.22.104.102:8080/api/deepseek-chat",{method:"POST",body:s});if(!n.ok){const i=await n.text();throw new Error(i||`请求失败: ${n.status}`)}const d=await n.json();d.choices&&d.choices.length>0?this.result=d.choices[0].message.content:this.result="AI未返回有效结果，请重试"}catch(n){console.error("Analysis error:",n),this.error=n.message||"分析请求失败，请检查网络连接或文件格式"}finally{this.loading=!1}},goBack(){this.$router.go(-1)},copyResult(){navigator.clipboard.writeText(this.result).then(()=>{const s=document.querySelector(".copy-btn");if(s){const e=s.textContent;s.textContent="已复制!",setTimeout(()=>{s.textContent=e},2e3)}}).catch(s=>{console.error("Failed to copy:",s),this.error="复制失败，请手动复制结果"})}}},w={class:"chat-uploader"},_={class:"file-upload-section"},M={class:"drop-content"},T={key:0,class:"hint-text text-danger"},C={key:0,class:"file-preview"},A={class:"file-count"},b={class:"file-list"},B={class:"file-info"},D={class:"file-name"},I={class:"file-size"},z={key:0,class:"file-type"},O=["onClick"],S={key:0,class:"warning"},j={class:"message-section"},L={class:"action-bar"},N=["disabled"],W={key:0,class:"loading-indicator"},R={key:1,class:"error"},U={key:2,class:"result"},V={class:"result-header"},E={class:"result-content"};function q(s,e,n,d,i,l){return a(),o("div",w,[t("button",{class:"back-button",onClick:e[0]||(e[0]=(...r)=>l.goBack&&l.goBack(...r))},"← 返回"),e[15]||(e[15]=t("h2",null,"AI 文件分析",-1)),t("div",_,[t("div",{class:m(["drop-zone",{"drag-active":i.dragOver}]),onDragover:e[2]||(e[2]=g(r=>i.dragOver=!0,["prevent"])),onDragleave:e[3]||(e[3]=r=>i.dragOver=!1),onDrop:e[4]||(e[4]=g((...r)=>l.handleDrop&&l.handleDrop(...r),["prevent"]))},[t("div",M,[t("input",{type:"file",multiple:"",ref:"fileInput",onChange:e[1]||(e[1]=(...r)=>l.handleFileChange&&l.handleFileChange(...r)),accept:".txt,.csv,.log,.json,.xml,.pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png"},null,544),e[8]||(e[8]=t("p",null,"拖放文件到此处或点击选择",-1)),e[9]||(e[9]=t("p",{class:"hint-text"}," 支持文本(.txt,.csv)、文档(.pdf,.docx)、图片(.jpg,.png)等格式 ",-1)),l.hasTextFiles?(a(),o("p",T," * 文本文件将直接发送内容给AI分析，请确认使用UTF-8编码 ")):h("",!0)])],34),i.files.length>0?(a(),o("div",C,[t("h3",null,[e[10]||(e[10]=f("已选文件 ")),t("span",A,"("+u(i.files.length)+"个)",1)]),t("div",b,[(a(!0),o(v,null,x(i.files,(r,c)=>(a(),o("div",{key:c,class:"file-item"},[t("div",B,[t("span",D,u(r.name),1),t("span",I,"("+u(l.formatFileSize(r.size))+")",1),l.isTextFile(r)?(a(),o("span",z,"文本文件")):h("",!0)]),t("button",{onClick:G=>l.removeFile(c),class:"remove-btn"},"×",8,O)]))),128))]),l.hasLargeFile?(a(),o("p",S,e[11]||(e[11]=[t("span",{class:"warning-icon"},"⚠",-1),f(" 文件超过1MB可能导致处理缓慢 ")]))):h("",!0)])):h("",!0)]),t("div",j,[y(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=r=>i.userMessage=r),placeholder:"输入你的问题或分析要求",rows:"5"},null,512),[[F,i.userMessage]]),t("div",L,[t("button",{onClick:e[6]||(e[6]=(...r)=>l.sendToAI&&l.sendToAI(...r)),disabled:i.loading||i.files.length===0&&!i.userMessage.trim()},u(i.loading?"分析中...":"发送分析请求"),9,N)])]),i.loading?(a(),o("div",W,e[12]||(e[12]=[t("div",{class:"spinner"},null,-1),t("p",null,"AI分析中，请稍候...",-1)]))):h("",!0),i.error?(a(),o("div",R,[e[13]||(e[13]=t("h3",null,"错误信息",-1)),t("p",null,u(i.error),1)])):h("",!0),i.result?(a(),o("div",U,[t("div",V,[e[14]||(e[14]=t("h3",null,"AI 分析结果",-1)),t("button",{onClick:e[7]||(e[7]=(...r)=>l.copyResult&&l.copyResult(...r)),class:"copy-btn"},"复制结果")]),t("div",E,u(i.result),1)])):h("",!0)])}const K=p(k,[["render",q],["__scopeId","data-v-39c28d1a"]]);export{K as default};
