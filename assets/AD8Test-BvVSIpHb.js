import{_ as T,r as u,b as O,d as U,u as V,c as a,e as p,a as s,t as c,F as b,f as k,o as l,w as E,g as J,v as j}from"./index-C23T03Zw.js";const q={class:"ad8-container"},B={key:0,class:"user-info"},F={key:1},M={class:"options"},P=["name","value","onUpdate:modelValue"],R=["disabled"],x={key:2,class:"loading"},L={key:3,class:"result"},Q={key:4,class:"error"},z={__name:"AD8Test",setup(G){const f=V(),n=u(JSON.parse(localStorage.getItem("currentUser"))||null);console.log("currentUser:",n.value);const i=u([]),d=u(JSON.parse(localStorage.getItem("ad8Answers"))||Array(8).fill(null)),v=u(!1),r=u(null),_=u(!1),g=u(""),N=O(()=>d.value.every(e=>e!==null)),y=async()=>{try{v.value=!0,r.value=null;const t=await(await fetch("http://172.22.104.102:8080/questions")).json();if(t.success)i.value=t.data;else throw new Error(t.message||"获取问题失败")}catch(e){r.value=e.message,console.error("获取问题失败:",e)}finally{v.value=!1}},S=()=>{localStorage.setItem("ad8Answers",JSON.stringify(d.value))},A=async()=>{try{v.value=!0,r.value=null;const e={hospitalInfo:{hospitalId:n.value.hospitalNumber,patientName:n.value.name},answers:i.value.map((m,h)=>({question_id:h+1,selected_option:d.value[h]}))};if(e.answers.length!==8)throw new Error("必须回答全部8个问题");console.log("提交数据:",e);const o=await(await fetch("http://172.22.104.102:8080/responses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(o.success)_.value=!0,g.value=o.response_id,localStorage.removeItem("ad8Answers");else throw new Error(o.message||"提交失败")}catch(e){r.value=e.message,console.error("提交失败:",e)}finally{v.value=!1}},I=()=>{f.push("/")},C=()=>{r.value=null,i.value.length===0&&y()};return U(()=>{if(!n.value){f.push("/login");return}y()}),(e,t)=>(l(),a("div",q,[n.value?(l(),a("div",B,[s("h3",null,"当前用户: "+c(n.value.name),1),s("p",null,"病历号: "+c(n.value.hospitalNumber),1)])):p("",!0),!_.value&&i.value.length>0?(l(),a("div",F,[t[0]||(t[0]=s("h2",null,"AD8早期痴呆筛查量表",-1)),(l(!0),a(b,null,k(i.value,(o,m)=>(l(),a("div",{key:o.id,class:"question-item"},[s("h3",null,c(m+1)+". "+c(o.text),1),s("div",M,[(l(!0),a(b,null,k(o.options,(h,w)=>(l(),a("label",{key:w},[E(s("input",{type:"radio",name:"q"+o.id,value:w,"onUpdate:modelValue":D=>d.value[m]=D,onChange:S},null,40,P),[[j,d.value[m]]]),J(" "+c(h),1)]))),128))])]))),128)),s("button",{onClick:A,disabled:!N.value,class:"submit-btn"}," 提交测试 ",8,R)])):p("",!0),v.value?(l(),a("div",x,t[1]||(t[1]=[s("p",null,"加载中...",-1)]))):p("",!0),_.value?(l(),a("div",L,[t[2]||(t[2]=s("h3",null,"测试提交成功！",-1)),s("p",null,"您的测试ID: "+c(g.value),1),s("button",{onClick:I,class:"reset-btn"},"返回首页")])):p("",!0),r.value?(l(),a("div",Q,[s("p",null,c(r.value),1),s("button",{onClick:C,class:"retry-btn"},"重试")])):p("",!0)]))}},K=T(z,[["__scopeId","data-v-678bfcab"]]);export{K as default};
